---
title: "Not so standard evaluations"
description: |
  Getting a better understanding of the tidyeval framework
author:
  - name: Lukas Gr√∂ninger
preview: img/glass.jpg
date: 2022-04-10
categories:
  - R
output:
  distill::distill_article:
    toc: true
    toc_depth: 3
    self_contained: false
draft: true
---



```{r setup, include=FALSE}
library(knitr)
library(kableExtra)
library(rmarkdown)
options(scipen = 100000, digits = 3)
opts_chunk$set(comment=NA, warning = FALSE, message = FALSE)

```


The R language has some peculiarities. One of these is the concept of 
non standard evaluation and the notion of Metaprogramming.

I'm not trying to explain these concepts in detail. There are great resources 
in the [{rlang}](https://rlang.r-lib.org/index.html) documentation as well as in  
the [Big Picture Chapture](https://adv-r.hadley.nz/meta-big-picture.html) of
Advanced R. 



I'm using R for quite some time now and these concepts have already given me 
some serious headaches (and probably continue to do so...). 
In the first two years of using R (it was my first programming language), I never
thought about the whole concept of closures, quasiquotation, 

- Defusing an expression
- Quasiquotation
- !! (Bang-Bang Operator) (force evaluation of part of an expression)
- Dynamic dots
- !!! (Big Bang or unquote-splice Operator)  

The you stumble across the Bang-Bang operator in a stack overflow thread

This post should serve as a resource to find other helpful articles on the topic
and to provide an example I used a couple of weeks ago.


- [Programming with Dplyr](https://dplyr.tidyverse.org/articles/programming.html) article
- [Tips on non-standard evaluation](https://renkun.me/2014/12/03/tips-on-non-standard-evaluation-in-r/) by Kun Ren
- [Standard and non standard evaluation](https://www.brodieg.com/2020/05/05/on-nse/) by Brodie Gaslam
- [Tidy Evaluation](https://tidyeval.tidyverse.org/sec-up-to-speed.html)
- [Tidy Eval is confusing sometimes](https://www.kelly-bodwin.com/blog/tidyeval/) by Kelly Bodwin






```{r}
library(tidyverse)
library(palmerpenguins)


```



```{r}
penguins



count_summary_stache <- function(df, vars, sort = TRUE) {
  col_names <- df |>
    select({{vars}}) |>
    names()
  
  col_names |>
    map(~count(df, !!sym(.x), sort = sort)) |>
    set_names(col_names)
}

count_summary_dots <- function(df, ..., sort = TRUE) {
  col_names <- df |>
    select(...) |>
    names()
  
  col_names |>
    map(~count(df, !!sym(.x), sort = sort)) |>
    set_names(col_names)
}


count_summary_tidyselect <- function(df, vars, sort = TRUE) {
  expr <- rlang::enquo(vars)
  col_names <- tidyselect::eval_select(expr, data = df) |>
    names()
  col_names |>
    map(~count(df, !!sym(.x), sort = sort)) |>
    set_names(col_names)
}









```






























