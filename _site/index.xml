<?xml version="1.0" encoding="UTF-8"?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" xmlns:media="http://search.yahoo.com/mrss/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:distill="https://distill.pub/journal/" version="2.0">
  <channel>
    <title>Lukas R Blog</title>
    <link>https://lukas-r.blog</link>
    <atom:link href="https://lukas-r.blog/index.xml" rel="self" type="application/rss+xml"/>
    <description>Lukas R Blog
</description>
    <generator>Distill</generator>
    <lastBuildDate>Tue, 01 Feb 2022 00:00:00 +0000</lastBuildDate>
    <item>
      <title>Keep up your Standards</title>
      <dc:creator>Lukas Gröninger</dc:creator>
      <link>https://lukas-r.blog/posts/2022-02-01-keep-up-your-standards</link>
      <description>


&lt;h2 id="introduction"&gt;Introduction&lt;/h2&gt;
&lt;p&gt;This post is about setting up new standard R and R-Markdown files to help you benefit from the &lt;strong&gt;default effect&lt;/strong&gt;. This effect makes use of the fact that people are inherently lazy. We suffer from the status quo bias. That means we tend to leave things as they are. This is why we just agree to General Terms and Conditions and accept all cookie tracking on websites. Companies and organizations are well aware of this flaw of ours and take advantage of it. This means we can leverage this behaviour as well to e.g. improve our code documentation. It is good practice to design decision architectures to “Improving decisions about health, wealth, and happiness” &lt;span class="citation"&gt;(Thaler and Sunstein 2009)&lt;/span&gt;.&lt;/p&gt;
&lt;aside&gt;
You will find lots of literature on the topic in the field of behavioural economics. Prominent authors are Daniel Kahnemann (&lt;em&gt;Thinking, fast and slow&lt;/em&gt;) and Richard Thaler (&lt;em&gt;Nudge&lt;/em&gt;)
&lt;/aside&gt;
&lt;h2 id="what-are-good-standards"&gt;What are good standards?&lt;/h2&gt;
&lt;p&gt;Code documentation is crucial for:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Maintainability&lt;/li&gt;
&lt;li&gt;Reproducibility&lt;/li&gt;
&lt;li&gt;General knowledge transfer&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="https://lukas-r.blog/posts/2022-02-01-keep-up-your-standardsimg/st_gzuz.gif" /&gt;&lt;/p&gt;
&lt;p&gt;When we create a new script we often don’t bother to give it a title, date or a short description about it’s purpose and further information. After all, we know exactly what we need it for, right? The problem is that this is not the case in 4 or 5 months from now. And even less if someone else wants to understand why this script exists. But we can set ourselves up for success by using smart default templates.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I will demonstrate how to change the default templates on a Windows machine using RStudio. The process for Macs and another IDE will look different.&lt;/p&gt;
&lt;h2 id="creating-default-r-templates"&gt;Creating default R templates&lt;/h2&gt;
&lt;p&gt;Currently when we go to New File -&amp;gt; R Script or type &lt;em&gt;Ctrl+Shift+N&lt;/em&gt; we see an empty script. To change that we have to create a templates folder first. In this new folder we’ll create a new default.R file. Now we can edit this file as we like.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# Required libraries
library(fs)
library(usethis)

# Create a templates folder
dir_create(path = &amp;quot;~/AppData/Roaming/RStudio/templates&amp;quot;)

# Create the file, here we start with a normal R script
file_create(&amp;quot;~/AppData/Roaming/RStudio/templates/default.R&amp;quot;)

# Open the file in RStudio to edit it
edit_file(&amp;quot;~/AppData/Roaming/RStudio/templates/default.R&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It is helpful to specify some meta information like Author, E-Mail or Date especially when these scripts are being shared with others. Another aspect is to use the code folding feature (shown in line 11).&lt;/p&gt;
&lt;p&gt;The result might look like this:&lt;/p&gt;
&lt;div class="figure"&gt;
&lt;img src="https://lukas-r.blog/posts/2022-02-01-keep-up-your-standardsimg/default_R.png" alt="" /&gt;
&lt;p class="caption"&gt;Modify default.R&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;We can do now the same for R-Markdown files. The procedure is the same.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# Now we do the same with an RMarkdown Script
file_create(&amp;quot;~/AppData/Roaming/RStudio/templates/default.Rmd&amp;quot;)

# And open the file in RStudio again
edit_file(&amp;quot;~/AppData/Roaming/RStudio/templates/default.Rmd&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here the template is somewhat more verbose. Often you know what things you enter repeatedly. These templates may look different for everyone.&lt;/p&gt;
&lt;div class="figure"&gt;
&lt;img src="https://lukas-r.blog/posts/2022-02-01-keep-up-your-standardsimg/default_Rmd.png" alt="" /&gt;
&lt;p class="caption"&gt;Modify default.Rmd&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id="the-next-step"&gt;The next step&lt;/h2&gt;
&lt;p&gt;You can not only create default templates for your local machine. The next step would be to create an R package for the sole purpose of containing a set of standardized default templates for e.g. your organization or your team. Let’s imagine you work in a company and you want to create specific reports on a regular basis. This would be a good use case to create a template for that.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://rstudio4edu.github.io/rstudio4edu-book/rmd-templates.html"&gt;Here&lt;/a&gt; is a great resource for doing that. I used it to create the &lt;a href="https://github.com/L-Groeninger/test_templates"&gt;{TestTemplates}&lt;/a&gt; package. Now everyone can just install the package and be able to use your templates.&lt;/p&gt;
&lt;div class="figure"&gt;
&lt;img src="https://lukas-r.blog/posts/2022-02-01-keep-up-your-standardsimg/create_empty_doc.png" alt="" /&gt;
&lt;p class="caption"&gt;TestTemplates Package&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id="conclusion"&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;In this post I went through the process of setting up default R templates. They do not ensure that all at once your code structure will be perfect. The idea is to reflect and work out how standards should be constructed for your particular case. The purpose of these templates is only to nudge us in the right direction towards a good code structure as well as programming practices.&lt;/p&gt;
&lt;pre class="r distill-force-highlighting-css"&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;div id="refs" class="references csl-bib-body hanging-indent"&gt;
&lt;div id="ref-thaler_nudge_2009" class="csl-entry"&gt;
Thaler, Richard H., and Cass R. Sunstein. 2009. &lt;em&gt;Nudge: Improving Decisions about Health, Wealth, and Happiness&lt;/em&gt;. New York: Penguin Books.
&lt;/div&gt;
&lt;/div&gt;</description>
      <distill:md5>4cf717c9ce28af195e6f99fc86505598</distill:md5>
      <category>R</category>
      <category>R-Studio</category>
      <guid>https://lukas-r.blog/posts/2022-02-01-keep-up-your-standards</guid>
      <pubDate>Tue, 01 Feb 2022 00:00:00 +0000</pubDate>
      <media:content url="https://lukas-r.blog/posts/2022-02-01-keep-up-your-standards/img/standard_1.jpg" medium="image" type="image/jpeg"/>
    </item>
    <item>
      <title>Scraping used boats</title>
      <dc:creator>Lukas Gröninger</dc:creator>
      <link>https://lukas-r.blog/posts/2022-01-10-scraping-used-boats</link>
      <description>


&lt;p&gt;In the last post I described how to use an API to download financial data. In this post I want to talk about accessing data from the web when we don’t have the luxury of using an API. Maybe there is an interface, but it is not publicly available. Or there is none and we still want to extract data. The concept we will use here is called Web Scraping. It is about collecting structured web data in an automated way. The example to demonstrate this process will be the website &lt;a href="https://www.boat24.com/en/"&gt;www.boat24.com&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://media.giphy.com/media/26xBExKCnvZLb0PzG/giphy.gif" /&gt;&lt;/p&gt;
&lt;p&gt;It is a european two sided marketplace to purchace or sell used sailing or motorboats. I’ve worked on ships for some years and enjoy going sailing during vacation. And so sometimes I end up looking at used sailboats on the Internet… Today the goal is to scrape information from this site.&lt;/p&gt;
&lt;p&gt;Let’s have a look:&lt;/p&gt;
&lt;div class="figure"&gt;
&lt;img src="https://lukas-r.blog/posts/2022-01-10-scraping-used-boatsimg/main_page.png" alt="" /&gt;
&lt;p class="caption"&gt;Source: www.boat24.com/en/sailboats/&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;We filtered for sailboats and see a list of boats and additional information. The total number of listings is 3296 boats. The general setup of the page is already quite good for our task.&lt;/p&gt;
&lt;h1 id="web-scraping"&gt;Web Scraping&lt;/h1&gt;
&lt;p&gt;Now I want to access information about the inventory of this marketplace. We can do this by investigating the structure of the website of interest.&lt;/p&gt;
&lt;aside&gt;
Make sure that it’s okay to scrape the site by looking at their &lt;a href="https://developers.google.com/search/docs/advanced/robots/intro"&gt;robots.txt file&lt;/a&gt;.
&lt;/aside&gt;
&lt;p&gt;This means answering questions like - &lt;em&gt;How is the content and the information loaded and displayed and what other requests are made in the background?&lt;/em&gt; We do this by having a look at the Developer Tools Panel (if you are using a Chrome Browser). On Windows this opens up after typing &lt;em&gt;Control+Shift+C&lt;/em&gt;. We will use it to inspect the different elements and extract and parse the relevant html/xml.&lt;/p&gt;
&lt;p&gt;The libraries we’ll need to perform the process of extracting information from a web page are the following:&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;library(tidyverse)  # Main data wrangling
library(rvest)      # Web scraping library
library(xml2)       # XML Parsing 
library(lubridate)  # Handling dates
library(sf)

# Setting theme
plotutils::set_custom_theme(base_size = 26)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We start by scrolling through the boats and click on a link in order to see a more detailed view of the specific boat listing. We see pictures of the boat and further information in a table below. When hovering over this table we see the section is called &lt;em&gt;“specs”&lt;/em&gt;.&lt;/p&gt;
&lt;div class="figure"&gt;
&lt;img src="https://lukas-r.blog/posts/2022-01-10-scraping-used-boatsimg/specs_html.png" alt="" /&gt;
&lt;p class="caption"&gt;Specs Tag&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;We are definitely interested in extracting this information. To identify this table we can right click and copy the xpath. But first we will set up our R script. We see that on every page there are&lt;br /&gt;
20 boats listed. The starting url from where we’ll navigate this site will therefore be &lt;em&gt;&lt;a href="https://www.boat24.com/en/sailboats/?page=0&amp;amp;sort=datdesc" class="uri"&gt;https://www.boat24.com/en/sailboats/?page=0&amp;amp;sort=datdesc&lt;/a&gt;&lt;/em&gt;.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# Starting url
url &amp;lt;- &amp;quot;https://www.boat24.com/en/sailboats/?page=0&amp;amp;sort=datdesc&amp;quot;

# Starting page number
page_num &amp;lt;- 0&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Afterwards we’ll initialize our dataframe with all the variables of interest that we want to extract.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# Initialize Dataframe (for the moment only char-variables, will be cleaned later)
boat_df &amp;lt;- tibble(id = character(),
                  type = character(),
                  price = character(),
                  condition = character(),
                  manufacturer = character(),
                  model = character(),
                  region = character(),
                  location = character(),
                  year = character(),
                  length_width = character(),
                  draft = character(),
                  displacement = character(),
                  material = character(),
                  steering = character(),
                  keel_type = character(),
                  ballast = character(),
                  no_persons = character(),
                  headroom = character(),
                  no_cabins = character(),
                  no_beds = character(),
                  propulsion = character(),
                  engine_perf = character(),
                  fuel_type = character(),
                  fuel_cap = character(),
                  engine_hours = character(),
                  mainsail = character(),
                  genoa = character(),
                  spinnaker = character(),
                  ad_date = character(),
                  no_views = character(),
                  no_favs = character())&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The process looks like this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Start with the landing page and find the list of boat links.&lt;/li&gt;
&lt;li&gt;Access each of these pages and extract relevant information.&lt;/li&gt;
&lt;li&gt;Go to the next page (increase the &lt;code&gt;page_num&lt;/code&gt; by 20) and repeat.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I will break it down into several steps.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# Start while loop with page_num = Number of Boats displayed at the top left                
while (page_num &amp;lt; 3280) {
  
  website &amp;lt;- read_html(url)
  # Extract boatlist of website
  boat_list &amp;lt;- website  |&amp;gt;  
    html_nodes(xpath = &amp;quot;/html/body/main/section[2]/div/ul/li&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We’ll use the &lt;code&gt;read_html()&lt;/code&gt; function from the {rvest} package to extract all of the html. with &lt;code&gt;html_nodes()&lt;/code&gt; we can specify which segment we want to read. We are interested in the links of the detail pages of the boats. With the help of the developer tool view we can select the element of interest, right click and copy the xpath. In the case of the &lt;em&gt;specs&lt;/em&gt; table this was “//*&lt;span class="citation"&gt;[@id='specs']&lt;/span&gt;“. For the ID, the price or the number of views, there are different xpaths which can be found by inspecting the elements of the site.&lt;/p&gt;
&lt;p&gt;In order to extract the relevant information we need to use some regular expressions (regex). To extract the condition of the boat we use for example a lookahead &lt;em&gt;“[^\n]+(?=Condition?)”&lt;/em&gt;.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# Loop through the 20 boats on the list
  for (i in seq_along(boat_list)) {
    
    boat_link &amp;lt;- xml_attrs(xml_child(boat_list[[i]], 1))[2]  
    # There are some google ads which have to be filtered by this if statement
    if (str_sub(boat_link, start = 1L, end = 22L) == &amp;quot;https://www.boat24.com&amp;quot;) {
      
      boat_link_site &amp;lt;- read_html(boat_link)
      # Read out the variables of interest with xpath or classes
      specs_table &amp;lt;- html_nodes(boat_link_site, 
                                xpath = &amp;quot;//*[@id=&amp;#39;specs&amp;#39;]&amp;quot;) %&amp;gt;% html_text()
      
      id &amp;lt;- html_nodes(
        boat_link_site, 
        xpath = &amp;quot;//*[@id=&amp;#39;sticky-header-trigger&amp;#39;]/div/div/aside/section[2]/ul[1]/li[1]/strong&amp;quot;)  |&amp;gt;  
        html_text() 
      type &amp;lt;- html_nodes(
        boat_link_site, 
        xpath = &amp;quot;//*[@id=&amp;#39;specs&amp;#39;]/header/p[1]/a[1]&amp;quot;) |&amp;gt;  
        html_text() 
      price &amp;lt;- html_nodes(
        boat_link_site, 
        xpath = &amp;quot;//*[@id=&amp;#39;contact&amp;#39;]/div[1]/p[1]/strong&amp;quot;)  |&amp;gt;  
        html_text()  
      region &amp;lt;- html_nodes(
        boat_link_site, 
        xpath = &amp;quot;//*[@id=&amp;#39;location&amp;#39;]/p/text()&amp;quot;) |&amp;gt;  
        html_text() 
      location &amp;lt;- html_nodes(
        boat_link_site, 
        xpath = &amp;quot;//*[@id=&amp;#39;location&amp;#39;]/p/strong&amp;quot;) |&amp;gt;  
        html_text() 

      condition &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Condition?)&amp;quot;)
      manufacturer &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Manufacturer?)&amp;quot;)
      model &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Model?)&amp;quot;)
      year &amp;lt;- str_extract(specs_table, &amp;quot;\\d+(?=Year Built?)&amp;quot;)
      length_width &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Length x Width?)&amp;quot;)
      draft &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Draft?)&amp;quot;)
      displacement &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Displacement?)&amp;quot;)
      material &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Material?)&amp;quot;) 
      steering &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Steering?)&amp;quot;)
      keel_type &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Keel Type?)&amp;quot;)
      ballast &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Ballast?)&amp;quot;)
      no_persons &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Certified No. of Persons?)&amp;quot;)
      headroom &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Headroom?)&amp;quot;)
      no_cabins &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=No. of Cabins?)&amp;quot;)
      no_beds &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=No. of Beds?)&amp;quot;)
      propulsion &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Propulsion?)&amp;quot;)
      engine_perf &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Engine Performance?)&amp;quot;)
      fuel_type &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Fuel Type?)&amp;quot;)
      fuel_cap &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Fuel Capacity?)&amp;quot;)
      engine_hours &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Engine Hours?)&amp;quot;)
      mainsail &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Mainsail?)&amp;quot;)
      genoa &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Genoa?)&amp;quot;)
      spinnaker &amp;lt;- str_extract(specs_table, &amp;quot;[^\n]+(?=Spinnaker?)&amp;quot;)
      
      ad_date &amp;lt;- html_nodes(
        boat_link_site, 
        xpath = &amp;quot;//*[@id=&amp;#39;sticky-header-trigger&amp;#39;]/div/div/aside/section[2]/ul[1]/li[2]/strong&amp;quot;) |&amp;gt;  
        html_text() 
      no_views &amp;lt;- html_nodes(
        boat_link_site, 
        xpath = &amp;quot;//*[@id=&amp;#39;sticky-header-trigger&amp;#39;]/div/div/aside/section[2]/ul[1]/li[3]/strong&amp;quot;) |&amp;gt;  
        html_text() 
      no_favs &amp;lt;- html_nodes(
        boat_link_site, 
        xpath = &amp;quot;//*[@id=&amp;#39;sticky-header-trigger&amp;#39;]/div/div/aside/section[2]/ul[1]/li[4]/strong&amp;quot;) |&amp;gt;  
        html_text()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;After having stored all information in variables we fill them in a dataframe/tibble. For some boats there were missing variables which had to be coded as &lt;code&gt;NA&lt;/code&gt;. We can write a short function to do that.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# Function to select only the first element, if empty --&amp;gt; NA
check_input &amp;lt;- function(x) if (is_empty(x)) NA else x[[1]]&lt;/code&gt;&lt;/pre&gt;
&lt;pre class="r"&gt;&lt;code&gt;      extracted_vars &amp;lt;- list(id, type, price, condition, manufacturer, model, region,
                             location, year, length_width, draft, displacement,
                             material, steering, keel_type, ballast, no_persons,
                             headroom, no_cabins, no_beds, propulsion, engine_perf,
                             fuel_type, fuel_cap, engine_hours, mainsail, genoa,
                             spinnaker, ad_date, no_views, no_favs)

      df &amp;lt;- extracted_vars |&amp;gt; 
        set_names(colnames(boat_df)) |&amp;gt; 
        map_df(check_input) 
      
    }
    # Rowbind the dataframe 
    boat_df &amp;lt;- bind_rows(boat_df, df)
  }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Afterwards the dataframe is appended to our previously created one. Then we have to increase the &lt;code&gt;page_num&lt;/code&gt; counter and go to the next page.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# Jump to the next page in steps of 20 (boats per page)
  page_num &amp;lt;- page_num + 20
  url &amp;lt;- paste0(&amp;quot;https://www.boat24.com/en/sailboats/?page=&amp;quot;, 
                as.character(page_num), &amp;quot;&amp;amp;sort=datdesc&amp;quot;)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In the end we can save our final dataframe as a csv or any other file format. Now we’ll look at the first entries of our data:&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;boat_df |&amp;gt; 
  head(3) |&amp;gt; 
  paged_table()&lt;/code&gt;&lt;/pre&gt;
&lt;div data-pagedtable="false"&gt;
&lt;script data-pagedtable-source type="application/json"&gt;
{"columns":[{"label":["id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["type"],"name":[2],"type":["chr"],"align":["left"]},{"label":["price"],"name":[3],"type":["chr"],"align":["left"]},{"label":["condition"],"name":[4],"type":["chr"],"align":["left"]},{"label":["manufacturer"],"name":[5],"type":["chr"],"align":["left"]},{"label":["model"],"name":[6],"type":["chr"],"align":["left"]},{"label":["region"],"name":[7],"type":["chr"],"align":["left"]},{"label":["location"],"name":[8],"type":["chr"],"align":["left"]},{"label":["year"],"name":[9],"type":["chr"],"align":["left"]},{"label":["length_width"],"name":[10],"type":["chr"],"align":["left"]},{"label":["draft"],"name":[11],"type":["chr"],"align":["left"]},{"label":["displacement"],"name":[12],"type":["chr"],"align":["left"]},{"label":["material"],"name":[13],"type":["chr"],"align":["left"]},{"label":["steering"],"name":[14],"type":["chr"],"align":["left"]},{"label":["keel_type"],"name":[15],"type":["chr"],"align":["left"]},{"label":["ballast"],"name":[16],"type":["chr"],"align":["left"]},{"label":["no_persons"],"name":[17],"type":["chr"],"align":["left"]},{"label":["headroom"],"name":[18],"type":["chr"],"align":["left"]},{"label":["no_cabins"],"name":[19],"type":["chr"],"align":["left"]},{"label":["no_beds"],"name":[20],"type":["chr"],"align":["left"]},{"label":["propulsion"],"name":[21],"type":["chr"],"align":["left"]},{"label":["engine_perf"],"name":[22],"type":["chr"],"align":["left"]},{"label":["fuel_type"],"name":[23],"type":["chr"],"align":["left"]},{"label":["fuel_cap"],"name":[24],"type":["chr"],"align":["left"]},{"label":["engine_hours"],"name":[25],"type":["chr"],"align":["left"]},{"label":["mainsail"],"name":[26],"type":["chr"],"align":["left"]},{"label":["genoa"],"name":[27],"type":["chr"],"align":["left"]},{"label":["spinnaker"],"name":[28],"type":["chr"],"align":["left"]},{"label":["ad_date"],"name":[29],"type":["chr"],"align":["left"]},{"label":["no_views"],"name":[30],"type":["chr"],"align":["left"]},{"label":["no_favs"],"name":[31],"type":["chr"],"align":["left"]}],"data":[{"1":"289862","2":"Sailing Yacht","3":"EUR 80.000,-","4":"good condition","5":"Najad","6":"Aphrodite 36","7":"Italy » Sicilia »","8":"Lipari- prossimamente a Procida","9":"1988","10":"10.95 m x 3.50 m","11":"1.00 - 1.40 m","12":"9'000 kg","13":"GRP","14":"Wheel control","15":"Long Keel","16":"NA","17":"7 Persons","18":"NA","19":"2 Cabins","20":"7 beds","21":"Saildrive","22":"1 x 35 HP / 26 kW","23":"Diesel","24":"150 l","25":"2'000 h","26":"25 m²","27":"25 m²","28":"35 m²","29":"10.12.2021","30":"1'148","31":"27"},{"1":"480117","2":"Sailing Yacht","3":"EUR 250.000,-","4":"As new","5":"Dehler","6":"38","7":"Germany » Ostsee »","8":"Stralsund","9":"2016","10":"11.64 m x 3.75 m","11":"2.03 m","12":"7'500 kg","13":"GRP","14":"Dual Wheel Control","15":"Bulb Keel","16":"NA","17":"8 Persons","18":"NA","19":"3 Cabins","20":"8 beds","21":"Saildrive","22":"1 x 38 HP / 28 kW","23":"Diesel","24":"160 l","25":"536 h","26":"80 m² (Battened Mainsail)","27":"NA","28":"NA","29":"12.12.2021","30":"743","31":"33"},{"1":"483884","2":"Cruising Yacht","3":"EUR 296.500,-","4":"good condition","5":"van de Stadt","6":"Tasman 48","7":"Spain » Costa del Sol »","8":"Almerimar","9":"1996","10":"14.97 m x 4.49 m","11":"2.40 m","12":"20'170 kg","13":"Steel","14":"Dual Wheel Control","15":"Long Keel","16":"5'700 kg","17":"8 Persons","18":"200 cm","19":"3 Cabins","20":"8 beds","21":"Inboard Direct-Drive","22":"1 x 160 HP / 118 kW","23":"Diesel","24":"1'120 l","25":"1'958 h","26":"90 m² (Battened Mainsail)","27":"60 m² (Roller Furling)","28":"180 m²","29":"15.10.2021","30":"919","31":"29"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  &lt;/script&gt;
&lt;/div&gt;
&lt;p&gt;For simplicity the variables are all encoded as character. The next step is to clean the data.&lt;/p&gt;
&lt;h1 id="data-cleaning"&gt;Data Cleaning&lt;/h1&gt;
&lt;p&gt;The main function to clean the data is the &lt;code&gt;readr::parse_number()&lt;/code&gt; function. With &lt;code&gt;across()&lt;/code&gt; we can apply this function to several variables. Another aspect is the fact that the prices are not displayed in a consistent format. That’s why I had to extract the currency and convert all prices in Euro.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;cleaned_df &amp;lt;- boat_df |&amp;gt;  
  drop_na(id) |&amp;gt; 
  distinct(id, .keep_all = TRUE) |&amp;gt; 
  separate(col = engine_perf, into = c(&amp;quot;no_eng&amp;quot;, &amp;quot;hp_eng&amp;quot;), sep = &amp;quot;x&amp;quot;) |&amp;gt;  
  separate(col = length_width, into = c(&amp;quot;length&amp;quot;, &amp;quot;width&amp;quot;), sep = &amp;quot;x&amp;quot;) |&amp;gt; 
  mutate(currency = str_sub(price, 1, 1),
         price = parse_number(price, 
                              locale = locale(decimal_mark = &amp;quot;,&amp;quot;, 
                                              grouping_mark = &amp;quot;.&amp;quot;)),
         hp_eng = str_extract(hp_eng, pattern = &amp;quot;(\\d)+(?= HP)&amp;quot;),
         displacement = parse_number(displacement,
                                     locale = locale(grouping_mark = &amp;quot;&amp;#39;&amp;quot;)),
         across(.cols = c(no_persons, draft, no_cabins, no_beds, headroom, fuel_cap, 
                engine_hours, no_views, no_favs, ballast, mainsail, genoa, year,
                spinnaker, no_eng, hp_eng, length, width),
                .fns = parse_number),
         region = case_when(str_detect(region, &amp;quot;United Kingdom&amp;quot;) ~ &amp;quot;United_Kingdom&amp;quot;,
                            str_detect(region, &amp;quot;United States&amp;quot;) ~ &amp;quot;USA&amp;quot;,
                            TRUE ~ region),
         country = str_extract(region, pattern = &amp;quot;\\w+&amp;quot;),
         price = case_when(currency == &amp;quot;£&amp;quot; ~ price*1.18,
                           currency == &amp;quot;C&amp;quot; ~ price*0.9,
                           currency == &amp;quot;D&amp;quot; ~ price*0.13,
                           currency == &amp;quot;E&amp;quot; ~ price*1,
                           currency == &amp;quot;S&amp;quot; ~ price*0.1,
                           currency == &amp;quot;U&amp;quot; ~ price*0.85,
                           TRUE ~ NA_real_),
         ad_date = dmy(ad_date))&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id="further-steps"&gt;Further steps&lt;/h1&gt;
&lt;p&gt;Now we could do some analysis, picking our favorite boat etc. We could calculate statistics of which boats get the most views or are getting marked as favorites most often. We could try to answer questions like - &lt;em&gt;Does the country where I sell my boat has an impact on the price?&lt;/em&gt; and so on.&lt;/p&gt;
&lt;h1 id="geographical-representation"&gt;Geographical Representation&lt;/h1&gt;
&lt;p&gt;At last I will give a geographical view on how many boats are listed in different european countries. Here I use a dataframe where I scraped information from not only sailing but motorboats as well. To plot it on a map, there are packages like &lt;code&gt;rnaturalearth&lt;/code&gt; or &lt;code&gt;spData&lt;/code&gt; which offer datasets for spatial analysis. There are lots of great &lt;a href="https://r-spatial.org/r/2018/10/25/ggplot2-sf-3.html"&gt;tutorials&lt;/a&gt; which show how to do that. I work with &lt;a href="https://r-spatial.github.io/sf/"&gt;&lt;em&gt;simple Features (sf)&lt;/em&gt;&lt;/a&gt; objects and {ggplot2}.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;ggplot() +
  geom_sf(data = df_e, aes(fill = n_listings)) +
  coord_sf(xlim = c(-15, 45), ylim = c(32, 70), expand = FALSE) +
  scale_fill_viridis_c(direction = -1) +
  labs(fill = &amp;quot;Number of listings&amp;quot;) +
  guides(fill = guide_colorbar(title.position = &amp;quot;top&amp;quot;, 
                                title.hjust = .5, 
                                barwidth = 10, 
                                barheight = 1))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src="file481ce104c1f_files/figure-html/unnamed-chunk-13-1.png" width="672" /&gt;&lt;/p&gt;
&lt;p&gt;We can directly see that this marketplace focuses mainly on the german/swiss market. The portfolio of boats outside of Central/Western Europe is negligible.&lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;In this post I wanted to show how to scrape information from a webpage. It is a useful skill to be able to analyze the structure of websites and see how they are built. I went with the Boat24.com example as I am interested in sailing yachts but the use cases are quite diverse. The Internet offers the largest source of data and with Webscraping it can be accessed. You could use it to compare prices of products on different websites, monitor competitors or just for general research tasks.&lt;/p&gt;
&lt;pre class="r distill-force-highlighting-css"&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;</description>
      <distill:md5>287bc069e3cd273eb5f89df7682ab1e4</distill:md5>
      <category>R</category>
      <category>Webscraping</category>
      <guid>https://lukas-r.blog/posts/2022-01-10-scraping-used-boats</guid>
      <pubDate>Sun, 09 Jan 2022 00:00:00 +0000</pubDate>
      <media:content url="https://lukas-r.blog/posts/2022-01-10-scraping-used-boats/img/used_boats.jpg" medium="image" type="image/jpeg"/>
    </item>
    <item>
      <title>API's and parameterized reports</title>
      <dc:creator>Lukas Gröninger</dc:creator>
      <link>https://lukas-r.blog/posts/2021-12-15-apis-and-parameterized-reports</link>
      <description>


&lt;h2 id="apis"&gt;API’s&lt;/h2&gt;
&lt;p&gt;API’s (Application Programming Interfaces) are crucial when it comes to applications or systems communicating with each other. Today they are everywhere around us and I guess we cannot imagine a world without them. We are interacting with API’s several times a day e.g. when we are using Google Maps or sending out a tweet.&lt;/p&gt;
&lt;div class="figure"&gt;
&lt;img src="https://lukas-r.blog/posts/2021-12-15-apis-and-parameterized-reportsimg/use_apis.jpg" alt="" /&gt;
&lt;p class="caption"&gt;Source: www.pexels.com&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;In the past years many organizations have decided to use an &lt;a href="https://swagger.io/resources/articles/adopting-an-api-first-approach/#:~:text=An%20API%2Dfirst%20approach%20means,be%20consumed%20by%20client%20applications."&gt;&lt;em&gt;API-first approach&lt;/em&gt;&lt;/a&gt; for their projects. I will not go into detail about what exactly an API is or how it works. There are many resources explaining it (&lt;a href="https://www.redhat.com/en/topics/api/what-are-application-programming-interfaces"&gt;here&lt;/a&gt; for example).&lt;/p&gt;
&lt;p&gt;In this blogpost I want to first show how to access the SimFin API and therefore gain access to financial information of more than 3000 public companies. Second I will demonstrate how to create your own financial (or any other) report.&lt;/p&gt;
&lt;h2 id="simfin"&gt;SimFin&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://simfin.com/"&gt;SimFin&lt;/a&gt; stands for &lt;strong&gt;sim&lt;/strong&gt;plifying &lt;strong&gt;fin&lt;/strong&gt;ance and is an organization that provides fundamental financial data about public companies for everyone. In order to get an API-key and download data you need to register with a mail account first. It is recommended to store the API-key in an environment variable. &lt;a href="https://daattali.gitbooks.io/stat545-ubc-github-io/content/bit003_api-key-env-var.html"&gt;Here&lt;/a&gt; is an article that describes how to do that. After having done that you are good to go.&lt;/p&gt;
&lt;h2 id="accessing-an-api"&gt;Accessing an API&lt;/h2&gt;
&lt;p&gt;First we’ll load all necessary libraries.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# required libraries
library(tidyverse) 
library(here)
library(simfinapi)
library(httr2)      # communicating with API&amp;#39;s through R
library(lubridate)  # Handling dates
library(gt)         # Pretty tables
library(gtExtras)

# Setting theme
plotutils::set_custom_theme(base_size = 30)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;On the simfin website you will find a link to their &lt;a href="https://simfin.com/api/v2/documentation/"&gt;Web API documentation&lt;/a&gt;. We start with an easy example of communicating with the API where we’ll request a list of available companies and their SimFinId.&lt;/p&gt;
&lt;p&gt;First we’ll store our API-key in a variable and create our url (web-address) with which we want to talk to. This information is available in the documentation.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;my_apikey &amp;lt;- Sys.getenv(&amp;quot;SIMFIN_KEY&amp;quot;)

base_url &amp;lt;- &amp;quot;https://simfin.com/api/v2/&amp;quot;

endpoint &amp;lt;- &amp;quot;companies/list&amp;quot;

# Create url
url &amp;lt;- paste0(base_url, endpoint, &amp;quot;?api-key=&amp;quot;, my_apikey)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now we could just copy paste this url in our browser and see the result:&lt;/p&gt;
&lt;div class="figure"&gt;
&lt;img src="https://lukas-r.blog/posts/2021-12-15-apis-and-parameterized-reportsimg/get_request_browser.PNG" alt="" /&gt;
&lt;p class="caption"&gt;Inserting our url in the browser&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;But fortunately there is a more elegant R package for communicating with API’s. The &lt;code&gt;{httr2}&lt;/code&gt; package is an advancement of the &lt;code&gt;{httr}&lt;/code&gt; package developed by &lt;a href="https://httr2.r-lib.org/"&gt;Hadley Wickham&lt;/a&gt;.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# create the request
req &amp;lt;- request(url) |&amp;gt; 
  req_perform()

# Check if it worked
resp_status(req)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[1] 200&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Glad to see that the request worked. Now we want to parse it’s raw output. In our case this is done via the &lt;code&gt;resp_bod_json()&lt;/code&gt; function (as we are dealing with json data - see the browser output). Then we are converting it to a dataframe/tibble.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;content_json &amp;lt;- resp_body_json(req) 

content_df &amp;lt;- tibble(simfin_id = map_dbl(content_json$data, 1),
                     ticker = map_chr(content_json$data, 2))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let’s have a look at the first few rows of our dataframe of available companies:&lt;/p&gt;
&lt;div id="wjzwyvwixp" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"&gt;
&lt;style&gt;html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#wjzwyvwixp .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wjzwyvwixp .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wjzwyvwixp .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wjzwyvwixp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wjzwyvwixp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wjzwyvwixp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wjzwyvwixp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wjzwyvwixp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wjzwyvwixp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wjzwyvwixp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wjzwyvwixp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wjzwyvwixp .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#wjzwyvwixp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wjzwyvwixp .gt_from_md &gt; :first-child {
  margin-top: 0;
}

#wjzwyvwixp .gt_from_md &gt; :last-child {
  margin-bottom: 0;
}

#wjzwyvwixp .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wjzwyvwixp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#wjzwyvwixp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wjzwyvwixp .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#wjzwyvwixp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wjzwyvwixp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wjzwyvwixp .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wjzwyvwixp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wjzwyvwixp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wjzwyvwixp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#wjzwyvwixp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wjzwyvwixp .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#wjzwyvwixp .gt_left {
  text-align: left;
}

#wjzwyvwixp .gt_center {
  text-align: center;
}

#wjzwyvwixp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wjzwyvwixp .gt_font_normal {
  font-weight: normal;
}

#wjzwyvwixp .gt_font_bold {
  font-weight: bold;
}

#wjzwyvwixp .gt_font_italic {
  font-style: italic;
}

#wjzwyvwixp .gt_super {
  font-size: 65%;
}

#wjzwyvwixp .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
&lt;/style&gt;
&lt;table class="gt_table"&gt;
  &lt;thead class="gt_header"&gt;
    &lt;tr&gt;
      &lt;th colspan="2" class="gt_heading gt_title gt_font_normal gt_bottom_border" style&gt;Available companies&lt;/th&gt;
    &lt;/tr&gt;
    
  &lt;/thead&gt;
  &lt;thead class="gt_col_headings"&gt;
    &lt;tr&gt;
      &lt;th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1"&gt;simfin_id&lt;/th&gt;
      &lt;th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"&gt;ticker&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody class="gt_table_body"&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_right"&gt;854465&lt;/td&gt;
&lt;td class="gt_row gt_left"&gt;1COV.DE&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_right"&gt;45846&lt;/td&gt;
&lt;td class="gt_row gt_left"&gt;A&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_right"&gt;1253413&lt;/td&gt;
&lt;td class="gt_row gt_left"&gt;A18&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_right"&gt;367153&lt;/td&gt;
&lt;td class="gt_row gt_left"&gt;AA&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_right"&gt;939324&lt;/td&gt;
&lt;td class="gt_row gt_left"&gt;AAC_delist&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_right"&gt;68568&lt;/td&gt;
&lt;td class="gt_row gt_left"&gt;AAL&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_right"&gt;847094&lt;/td&gt;
&lt;td class="gt_row gt_left"&gt;AAMC&lt;/td&gt;&lt;/tr&gt;
  &lt;/tbody&gt;
  
  
&lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;After scrolling through the first entries we recognize the AAPL ticker belonging to Apple. Now we’ll have a closer look at this company and extend our request with more fields.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# Define ticker. We want to have a look at Apple
ticker &amp;lt;- &amp;quot;AAPL&amp;quot;

# the statement to retrieve. (profit/loss)
statement &amp;lt;- &amp;quot;pl&amp;quot;

# the period &amp;amp; financial year to retrieve
period &amp;lt;- &amp;quot;q4&amp;quot;
fyear &amp;lt;- 2021

# create url
url &amp;lt;- paste0(base_url, &amp;quot;companies/statements?api-key=&amp;quot;, my_apikey, &amp;quot;&amp;amp;ticker=&amp;quot;, ticker, 
              &amp;quot;&amp;amp;statement=&amp;quot;, statement, &amp;quot;&amp;amp;period=&amp;quot;, period,&amp;quot;&amp;amp;fyear=&amp;quot;, fyear)

# make request
apple_req &amp;lt;- request(url) |&amp;gt; 
  req_perform()

# convert JSON
apple_json &amp;lt;- resp_body_json(apple_req)[[1]]

apple_df &amp;lt;- tibble(variable = map_chr(apple_json$columns, 1),
                   value = map_chr(apple_json$data[[1]], 1, .null = NA_character_))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now we can inspect some information for Apple’s last quarter.&lt;/p&gt;
&lt;div id="xfbyzhlayd" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"&gt;
&lt;style&gt;html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#xfbyzhlayd .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xfbyzhlayd .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xfbyzhlayd .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xfbyzhlayd .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xfbyzhlayd .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xfbyzhlayd .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xfbyzhlayd .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xfbyzhlayd .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xfbyzhlayd .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xfbyzhlayd .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xfbyzhlayd .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xfbyzhlayd .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#xfbyzhlayd .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xfbyzhlayd .gt_from_md &gt; :first-child {
  margin-top: 0;
}

#xfbyzhlayd .gt_from_md &gt; :last-child {
  margin-bottom: 0;
}

#xfbyzhlayd .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xfbyzhlayd .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#xfbyzhlayd .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xfbyzhlayd .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#xfbyzhlayd .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xfbyzhlayd .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xfbyzhlayd .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xfbyzhlayd .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xfbyzhlayd .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xfbyzhlayd .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#xfbyzhlayd .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xfbyzhlayd .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#xfbyzhlayd .gt_left {
  text-align: left;
}

#xfbyzhlayd .gt_center {
  text-align: center;
}

#xfbyzhlayd .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xfbyzhlayd .gt_font_normal {
  font-weight: normal;
}

#xfbyzhlayd .gt_font_bold {
  font-weight: bold;
}

#xfbyzhlayd .gt_font_italic {
  font-style: italic;
}

#xfbyzhlayd .gt_super {
  font-size: 65%;
}

#xfbyzhlayd .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
&lt;/style&gt;
&lt;table class="gt_table"&gt;
  &lt;thead class="gt_header"&gt;
    &lt;tr&gt;
      &lt;th colspan="2" class="gt_heading gt_title gt_font_normal gt_bottom_border" style&gt;Apple's 4. Quarter 2021&lt;/th&gt;
    &lt;/tr&gt;
    
  &lt;/thead&gt;
  &lt;thead class="gt_col_headings"&gt;
    &lt;tr&gt;
      &lt;th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"&gt;variable&lt;/th&gt;
      &lt;th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"&gt;value&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody class="gt_table_body"&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_left"&gt;Ticker&lt;/td&gt;
&lt;td class="gt_row gt_left"&gt;AAPL&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_left"&gt;Report Date&lt;/td&gt;
&lt;td class="gt_row gt_left"&gt;2021-09-30&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_left"&gt;Publish Date&lt;/td&gt;
&lt;td class="gt_row gt_left"&gt;2021-10-29&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_left"&gt;Revenue&lt;/td&gt;
&lt;td class="gt_row gt_left"&gt;83360000000.000000&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_left"&gt;Gross Profit&lt;/td&gt;
&lt;td class="gt_row gt_left"&gt;35174000000.000000&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_left"&gt;Operating Expenses&lt;/td&gt;
&lt;td class="gt_row gt_left"&gt;-11388000000.000000&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_left"&gt;Research &amp;amp; Development&lt;/td&gt;
&lt;td class="gt_row gt_left"&gt;-5772000000.000000&lt;/td&gt;&lt;/tr&gt;
  &lt;/tbody&gt;
  
  
&lt;/table&gt;
&lt;/div&gt;
&lt;h3 id="the-simfinapi-package"&gt;The {simfinapi} package&lt;/h3&gt;
&lt;p&gt;Accessing the API in this way is somewhat cumbersome for more complex matters. But thankfully someone has written an R package for this as well.&lt;/p&gt;
&lt;p&gt;Thanks to &lt;a href="https://github.com/matthiasgomolka"&gt;Matthias Gomolka&lt;/a&gt; for maintaining the {simfinapi} &lt;a href="https://github.com/matthiasgomolka/simfinapi"&gt;R package&lt;/a&gt;. This package wraps the SimFin API and allows us an easier access.&lt;/p&gt;
&lt;p&gt;First we set our API-key and a cache directory for our requests.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# Setting the api key
sfa_set_api_key(api_key = Sys.getenv(&amp;quot;SIMFIN_KEY&amp;quot;))
# Setting up cache directory
sfa_set_cache_dir(here(&amp;quot;_posts/2021-12-15-apis-and-parameterized-reports&amp;quot;, 
                       &amp;quot;simfin_cache&amp;quot;), create = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now we can use a set of functions to retrieve the information of interest. Our first request can be rewritten in one line as this:&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;available_companies &amp;lt;- sfa_get_entities()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If we want to look at some basic information for a company like Apple, we would write:&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;company_infos &amp;lt;- sfa_get_info(ticker = &amp;quot;AAPL&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id="reporting-with-r"&gt;Reporting with R&lt;/h2&gt;
&lt;p&gt;One of the biggest strengths of R is its ability to produce beautiful reproducible reports and articles. This is done with &lt;a href="https://rmarkdown.rstudio.com/"&gt;{RMarkdown}&lt;/a&gt; and additional packages like {knitr}, {distill} etc. To learn more, I recommend the &lt;a href="https://bookdown.org/yihui/rmarkdown-cookbook/"&gt;RMarkdown Cookbook&lt;/a&gt; by Yihui Xie, Christophe Dervieux and Emily Riederer.&lt;/p&gt;
&lt;p&gt;For our small example report we want to focus on a specific set of companies. Let’s say we want to know how the stock prices of different social media networks performed in 2020. Were all companies equally affected by the Corona Virus? What we want also is to be able to change the set of companies as well as the year of interest programmatically when rendering the report. RMarkdown lets you define specific parameters at the top that you can access then inside your R code chunks.&lt;/p&gt;
&lt;p&gt;To include these parameters in our report we have to define them first in the YAML header of our document. In our case this may look like this:&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;params:
  stocks: [&amp;quot;FB&amp;quot;, &amp;quot;TWTR&amp;quot;, &amp;quot;SNAP&amp;quot;, &amp;quot;PINS&amp;quot;]
  fiscal_year: 2020&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here we provide a list of stocks and the fiscal year as variables. We can access for example the list of stocks in our script with &lt;code&gt;params$stocks&lt;/code&gt;.&lt;/p&gt;
&lt;h3 id="stock-prices-over-the-year"&gt;Stock prices over the year&lt;/h3&gt;
&lt;p&gt;In this manner we can now use our parameters as arguments for the {simfinapi} functions.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# Get company infos
company_infos &amp;lt;- sfa_get_info(ticker = params$stocks)

# Get stock prices of companies of interest
shares &amp;lt;- sfa_get_prices(ticker = params$stocks) |&amp;gt; 
  left_join(company_infos)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now we can generate an outpot comparing the stock price development over the year we specified before.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;shares |&amp;gt; 
  mutate(year = year(date)) |&amp;gt; 
  # Filter only prices for our year of interest
  filter(year == params$fiscal_year) |&amp;gt; 
  ggplot(aes(x = date, y = adj_close)) +
  geom_line() +
  scale_y_continuous(labels = scales::dollar_format()) +
  facet_wrap(~company_name, scales = &amp;quot;free_y&amp;quot;) +
  scale_x_date(date_breaks = &amp;quot;3 months&amp;quot;, date_labels = &amp;quot;%b&amp;quot;) +
  labs(title = glue::glue(&amp;quot;Stock prices over the year {params$fiscal_year}&amp;quot;),
       x = NULL,
       y = NULL)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src="file481c2e55772_files/figure-html/unnamed-chunk-12-1.png" width="768" /&gt;&lt;/p&gt;
&lt;p&gt;We can not only filter by our parameters but also using it to dynamically change the title of the plot. With different scales it is hard to compare the development between the selected companies. That’s why we’ll produce a plot with a logarithmized y axis.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;shares |&amp;gt;  
  mutate(year = year(date)) |&amp;gt;  
  filter(year == params$fiscal_year) |&amp;gt; 
  ggplot(aes(x = date, y = adj_close, colour = company_name)) +
  geom_line(lwd = 1) +
  scale_y_continuous(trans = &amp;quot;log10&amp;quot;, labels = scales::dollar_format()) +
  viridis::scale_colour_viridis(discrete = TRUE) +
  scale_x_date(date_breaks = &amp;quot;3 months&amp;quot;, date_labels = &amp;quot;%b&amp;quot;) +
  labs(title = &amp;quot;Comparison with logarithmized y axis&amp;quot;,
       x = NULL,
       y = NULL,
       colour = NULL) &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src="file481c2e55772_files/figure-html/unnamed-chunk-13-1.png" width="768" /&gt;&lt;/p&gt;
&lt;p&gt;Here we can see directly the comparison between companies and specifically the “Corona effect” in the middle of march. By now I guess many have seen logarithmized scales as they were quite popular to illustrate exponential growth of Corona Virus cases. The difference between 10$ and 100$ is the same as the difference between 30$ and 300$. The social network whose share price has risen the most is Pinterest. One hypothesis is that Pinterest in particular could benefit from the retreat into the own four walls. On this platform, the topics of designing and decorating the home, garden etc. are popular.&lt;/p&gt;
&lt;h3 id="creating-your-own-metric"&gt;Creating your own metric&lt;/h3&gt;
&lt;p&gt;Now we don’t want to only compare the development of the stock prices, but have a deeper look at some characteristics of these companies. The SimFin API offers a variety of variables and information. We can access them through the {simfinapi} function &lt;code&gt;sfa_get_statement()&lt;/code&gt;. For now, we want to calculate our own metric to compare our four companies. This metric will be the &lt;em&gt;Rule of 40&lt;/em&gt;&lt;a href="#fn1" class="footnote-ref" id="fnref1"&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; which is typically applied to SaaS (Software as a Service) companies to evaluate their development. Two metrics will be combined here. One is the growth of the company and the other is profit. In the first years of a company, it is common that there is no profit yet, but an emphasis on growth. As a rule of thumb the sum of growth and profit should equal to at least 40. For example 50% Growth and -10% Profit Margin would still satisfy this condition.&lt;/p&gt;
&lt;p&gt;&lt;span class="math display"&gt;\[
Rule\; of\; 40 = Growth + Profit\; Margin
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This simple metric can, of course, also be weighted if one of the two components is considered more relevant. Now let’s examine what this metric looks like for companies at the end of the fiscal year.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# The net profit margin information is found in the &amp;quot;derived&amp;quot; statement
derived_q4 &amp;lt;- sfa_get_statement(ticker = params$stocks,
                                fyear = params$fiscal_year,
                                period = &amp;quot;q4&amp;quot;,
                                statement = &amp;quot;derived&amp;quot;)

derived_q3 &amp;lt;- sfa_get_statement(ticker = params$stocks,
                                fyear = params$fiscal_year,
                                period = &amp;quot;q3&amp;quot;,
                                statement = &amp;quot;derived&amp;quot;)

# The revenue information can be found in the pl (profit/loss) statement
profit_loss_q4 &amp;lt;- sfa_get_statement(ticker = params$stocks,
                                    fyear = params$fiscal_year,
                                    period = &amp;quot;q4&amp;quot;,
                                    statement = &amp;quot;pl&amp;quot;)

profit_loss_q3 &amp;lt;- sfa_get_statement(ticker = params$stocks,
                                    fyear = params$fiscal_year,
                                    period = &amp;quot;q3&amp;quot;,
                                    statement = &amp;quot;pl&amp;quot;)
# Define our own Metric
rule_40 &amp;lt;- profit_loss_q4 |&amp;gt; 
  select(ticker, fiscal_year, revenue) |&amp;gt; 
  mutate(growth = revenue/profit_loss_q3$revenue - 1) |&amp;gt; 
  inner_join(select(derived_q4, net_profit_margin, ticker)) |&amp;gt; 
  mutate(rule_40 = growth + net_profit_margin,
         revenue = revenue/1e6)&lt;/code&gt;&lt;/pre&gt;
&lt;div id="wfmrbsgoqg" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"&gt;
&lt;style&gt;html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#wfmrbsgoqg .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wfmrbsgoqg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wfmrbsgoqg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wfmrbsgoqg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wfmrbsgoqg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wfmrbsgoqg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wfmrbsgoqg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wfmrbsgoqg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wfmrbsgoqg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wfmrbsgoqg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wfmrbsgoqg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wfmrbsgoqg .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#wfmrbsgoqg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wfmrbsgoqg .gt_from_md &gt; :first-child {
  margin-top: 0;
}

#wfmrbsgoqg .gt_from_md &gt; :last-child {
  margin-bottom: 0;
}

#wfmrbsgoqg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wfmrbsgoqg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#wfmrbsgoqg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wfmrbsgoqg .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#wfmrbsgoqg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wfmrbsgoqg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wfmrbsgoqg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wfmrbsgoqg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wfmrbsgoqg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wfmrbsgoqg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#wfmrbsgoqg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wfmrbsgoqg .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#wfmrbsgoqg .gt_left {
  text-align: left;
}

#wfmrbsgoqg .gt_center {
  text-align: center;
}

#wfmrbsgoqg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wfmrbsgoqg .gt_font_normal {
  font-weight: normal;
}

#wfmrbsgoqg .gt_font_bold {
  font-weight: bold;
}

#wfmrbsgoqg .gt_font_italic {
  font-style: italic;
}

#wfmrbsgoqg .gt_super {
  font-size: 65%;
}

#wfmrbsgoqg .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
&lt;/style&gt;
&lt;table class="gt_table"&gt;
  &lt;thead class="gt_header"&gt;
    &lt;tr&gt;
      &lt;th colspan="6" class="gt_heading gt_title gt_font_normal gt_bottom_border" style&gt;Rule of 40&lt;/th&gt;
    &lt;/tr&gt;
    
  &lt;/thead&gt;
  &lt;thead class="gt_col_headings"&gt;
    &lt;tr&gt;
      &lt;th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"&gt;ticker&lt;/th&gt;
      &lt;th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1"&gt;fiscal_year&lt;/th&gt;
      &lt;th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1"&gt;revenue&lt;/th&gt;
      &lt;th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1"&gt;growth&lt;/th&gt;
      &lt;th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1"&gt;net_profit_margin&lt;/th&gt;
      &lt;th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1"&gt;rule_40&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody class="gt_table_body"&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_left"&gt;FB&lt;/td&gt;
&lt;td class="gt_row gt_right"&gt;2020&lt;/td&gt;
&lt;td class="gt_row gt_right"&gt;28071&lt;/td&gt;
&lt;td class="gt_row gt_right"&gt;0.307&lt;/td&gt;
&lt;td class="gt_row gt_right"&gt;0.400&lt;/td&gt;
&lt;td class="gt_row gt_right" style="background-color: #56B5A8; color: #000000;"&gt;0.707&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_left"&gt;PINS&lt;/td&gt;
&lt;td class="gt_row gt_right"&gt;2020&lt;/td&gt;
&lt;td class="gt_row gt_right"&gt;706&lt;/td&gt;
&lt;td class="gt_row gt_right"&gt;0.594&lt;/td&gt;
&lt;td class="gt_row gt_right"&gt;0.295&lt;/td&gt;
&lt;td class="gt_row gt_right" style="background-color: #2BA193; color: #000000;"&gt;0.889&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_left"&gt;SNAP&lt;/td&gt;
&lt;td class="gt_row gt_right"&gt;2020&lt;/td&gt;
&lt;td class="gt_row gt_right"&gt;911&lt;/td&gt;
&lt;td class="gt_row gt_right"&gt;0.343&lt;/td&gt;
&lt;td class="gt_row gt_right"&gt;-0.124&lt;/td&gt;
&lt;td class="gt_row gt_right" style="background-color: #AEEAE3; color: #000000;"&gt;0.219&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td class="gt_row gt_left"&gt;TWTR&lt;/td&gt;
&lt;td class="gt_row gt_right"&gt;2020&lt;/td&gt;
&lt;td class="gt_row gt_right"&gt;1289&lt;/td&gt;
&lt;td class="gt_row gt_right"&gt;0.377&lt;/td&gt;
&lt;td class="gt_row gt_right"&gt;0.172&lt;/td&gt;
&lt;td class="gt_row gt_right" style="background-color: #74C6BB; color: #000000;"&gt;0.549&lt;/td&gt;&lt;/tr&gt;
  &lt;/tbody&gt;
  
  
&lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;Pinterest reached with almost 60% the highest growth relative to the previous quarter. Facebook - or Meta as it’s now being called - had the highest profitability. Added together only Snap was not able to satisfy the Rule of 40 metric.&lt;/p&gt;
&lt;p&gt;In such a way, reports can now be created programmatically. If we want to e.g. exchange Snapchat with Google (Ticker is GOOG), we would render our report as follows:&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;rmarkdown::render(my_report.Rmd, 
                  params = list(stocks = c(&amp;quot;FB&amp;quot;, &amp;quot;TWTR&amp;quot;, &amp;quot;GOOG&amp;quot;, &amp;quot;PINS&amp;quot;)))&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id="conclusion"&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;There are countless possibilities to create specific reporting templates and functions for your own use cases. Maybe you need to report regularly on companies or industries? This post should give you the tools to do that by accessing the SimFin API. A really minimal example of how such a report might look like can be found &lt;a href="https://github.com/L-Groeninger/lukas-r.blog/tree/main/_posts/2021-12-15-apis-and-parameterized-reports"&gt;here&lt;/a&gt; in the Github repo of this blogpost. The output format is of course not limited to html, but can be PDF as well.&lt;/p&gt;
&lt;p&gt;Another use case could be creating a report to regularly display Social Media statistics or the number of people who visited your website. For the latter purpose you could access the Google Analytics API e.g. via the {googleAnalyticsR} package. However, the setup would be similar to the one presented here.&lt;/p&gt;
&lt;pre class="r distill-force-highlighting-css"&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;div class="footnotes"&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id="fn1"&gt;&lt;p&gt;&lt;a href="https://kpisense.com/glossary/rule-of-40" class="uri"&gt;https://kpisense.com/glossary/rule-of-40&lt;/a&gt;&lt;a href="#fnref1" class="footnote-back"&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description>
      <distill:md5>520c42a79470016a2eede2e2c93ae27a</distill:md5>
      <category>R</category>
      <category>API</category>
      <category>reporting</category>
      <guid>https://lukas-r.blog/posts/2021-12-15-apis-and-parameterized-reports</guid>
      <pubDate>Wed, 15 Dec 2021 00:00:00 +0000</pubDate>
      <media:content url="https://lukas-r.blog/posts/2021-12-15-apis-and-parameterized-reports/img/use_apis.jpg" medium="image" type="image/jpeg"/>
    </item>
    <item>
      <title>Looping over the bridge</title>
      <dc:creator>Lukas Gröninger</dc:creator>
      <link>https://lukas-r.blog/posts/2021-12-05-looping-over-the-bridge</link>
      <description>


&lt;p&gt;A few weeks ago I did an introductory R workshop where one of the students asked about loops and the difference of &lt;em&gt;for&lt;/em&gt; vs &lt;em&gt;while&lt;/em&gt; loops. This blogpost is about illustrating these two types of loops using a simulation example.&lt;/p&gt;
&lt;h1 id="let-the-game-begin"&gt;Let the Game begin&lt;/h1&gt;
&lt;p&gt;I think the majority knows the Netflix show “Squid Game”. In this series the contestants have to survive several deadly games. Here I want to focus on the 5. game of the show. There are 16 players who have to pass a bridge of 18 * 2 glass plates. At each step they have to decide on which plate they step. With a 50% chance they jump on the harder glass which is able to hold their body, the other 50% will mean their death. As I was watching the show I thought that this would be a perfect example to answer a statistical question by using loops and simulation.&lt;/p&gt;
&lt;p&gt;The question I wanted to answer was:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;How many players do we expect to survive the game?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="figure"&gt;
&lt;img src="C:/Users/lukas/Desktop/Kram/lukas-r.blog/_posts/2021-12-05-looping-over-the-bridge/img/squid_game_bridge.jpg" alt="Source: https://www.distractify.com/p/games-played-in-squid-game" width="600" /&gt;
&lt;p class="caption"&gt;
(#fig:unnamed-chunk-1)Source: &lt;a href="https://www.distractify.com/p/games-played-in-squid-game" class="uri"&gt;https://www.distractify.com/p/games-played-in-squid-game&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Remark:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;After opening twitter, I came across a tweet discussing John Helveston’s &lt;a href="https://www.jhelvy.com/posts/2021-10-19-monte-carlo-bridge-game/"&gt;blogpost&lt;/a&gt; where he basically explained exactly what I wanted to do. I highly recommend his &lt;a href="https://www.jhelvy.com/blog.html"&gt;blog&lt;/a&gt;. I adapted his &lt;code&gt;run_game&lt;/code&gt; function and where he used &lt;code&gt;data.table&lt;/code&gt; I went with the &lt;em&gt;tidy&lt;/em&gt; alternative.&lt;/p&gt;
&lt;h2 id="monte-carlo-solution"&gt;Monte Carlo Solution&lt;/h2&gt;
&lt;p&gt;We can solve the question about the number of survivors to expect by simulating the game. When using random simulation to answer statistical problems, this is called Monte Carlo Simulation.&lt;/p&gt;
&lt;p&gt;First we load the necessary library and set a custom theme for our plots.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;library(tidyverse)
library(microbenchmark)

plotutils::set_custom_theme(base_size = 32)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then we create a dataframe as an input for the game. In this dataframe the &lt;code&gt;alive&lt;/code&gt; column is set to 1 as in the beginning obviously every player is alive.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# Define number of players
num_players &amp;lt;- 16
players &amp;lt;- tibble(player = seq(num_players), 
                  alive = 1)

# Let&amp;#39;s have a look at the dataframe
players&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;# A tibble: 16 x 2
   player alive
    &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt;
 1      1     1
 2      2     1
 3      3     1
 4      4     1
 5      5     1
 6      6     1
 7      7     1
 8      8     1
 9      9     1
10     10     1
11     11     1
12     12     1
13     13     1
14     14     1
15     15     1
16     16     1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now we are going to create the function for our game. This is a great example to look at the differences between for and while loops.&lt;/p&gt;
&lt;p&gt;We start by creating a function using a for loop:&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# Define a function for simulating one game using a for loop
run_game_for &amp;lt;- function(players, num_steps) {
  lead_player &amp;lt;- 1
  for (step in seq(num_steps)) {
    # 50% chance that the glass is safe
    if (sample(c(TRUE, FALSE), 1)) {
      # It is safe, now the player can try the next one!
      next
    } else {
      # The glass broke...
      # Before continuing, check if any players are still alive
      if (sum(players$alive) == 0) { return(0) }
      # The lead player died
      players$alive[lead_player] &amp;lt;- 0
      lead_player &amp;lt;- lead_player + 1
    }
  }
  return(sum(players$alive))
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then we create a function using a while loop. The setup is quite similar to the previously used &lt;code&gt;run_game_for&lt;/code&gt; function.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# Define a function for simulating one game using a while loop
run_game_while &amp;lt;- function(players, num_steps) {
  # Initialize starting values
  lead_player &amp;lt;- 1
  current_step &amp;lt;- 0
  game_running &amp;lt;- TRUE
  
  while (game_running) {
    # Let&amp;#39;s see if the glass holds...
    if (sample(c(TRUE, FALSE), 1)) {
      # The glass holds and the player can go one step further
      current_step &amp;lt;- current_step + 1
    } else {
      # Check if there are still players alive, if not end the game
      if (sum(players$alive) == 0) { return(0)}
      # Apparently the glass didnt hold and the current lead player dies
      players$alive[lead_player] &amp;lt;- 0
      lead_player &amp;lt;- lead_player + 1
      # Anyway the player can go one step further 
      current_step &amp;lt;- current_step + 1
    }
    if (current_step == num_steps) {
      # If they got to the last step, they did it and the game stops
      game_running &amp;lt;- FALSE
    }
  }
  # Return the number of remaining players
  return(sum(players$alive))
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let’s give it a try and see how many survive in our game.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;set.seed(001)

# Run one iteration of the game
single_game &amp;lt;- run_game_while(players, num_steps = 18)
single_game&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[1] 9&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We were interested in the expected value of the outcome. One iteration is not enough, but this is no problem at all. We can simply simulate our game multiple times.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# Set seed value to keep reproducibility and to give a hint who wins the game
set.seed(456)

# Define number of runs or games we want to play
n_runs &amp;lt;- 10000

# Create dataframe with outcome of each game
sims &amp;lt;- tibble(trial = seq(n_runs)) |&amp;gt; 
  rowwise() |&amp;gt; 
  mutate(while_loop = run_game_while(players, num_steps = 18),
         for_loop = run_game_for(players, num_steps = 18)) |&amp;gt; 
  pivot_longer(-trial, names_to = &amp;quot;loop&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Have a look at the descriptive statistics:&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;summary(sims$value)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    6.00    7.00    6.98    8.00   15.00 &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;There were games where zero players survived the game and there were games where almost all players managed to survive.&lt;/p&gt;
&lt;p&gt;Of course we can also visualize our distribution:&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;# Visualizing the resulting distribution
sims |&amp;gt; 
  ggplot(aes(x = value, fill = loop)) +
  geom_bar(position = position_dodge()) +
  scale_x_continuous(breaks = seq(0, num_players)) +
  labs(title = &amp;quot;Distribution of numbers of surviving players&amp;quot;,
       x = &amp;quot;N surviving players&amp;quot;,
       fill = NULL)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src="file481c9901886_files/figure-html/unnamed-chunk-9-1.png" width="768" /&gt;&lt;/p&gt;
&lt;p&gt;The two different colours indicate which function was used to calculate the result. From this graph we directly see almost the exact same result from the two functions.&lt;/p&gt;
&lt;p&gt;To answer our previously posed question: We would expect 7 players to survive the game.&lt;/p&gt;
&lt;h2 id="benchmarking-for-vs-while-loop"&gt;Benchmarking for vs while loop&lt;/h2&gt;
&lt;p&gt;Now we can also test the performance of the different functions against each other.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;set.seed(001)

test &amp;lt;- microbenchmark(
  run_game_for(players, num_steps = 18),
  run_game_while(players, num_steps = 18)
)

autoplot(test)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src="file481c9901886_files/figure-html/unnamed-chunk-10-1.png" width="960" /&gt;&lt;/p&gt;
&lt;p&gt;Again there is not really a difference…&lt;/p&gt;
&lt;h2 id="mathematical-solution"&gt;Mathematical Solution&lt;/h2&gt;
&lt;p&gt;Of course we can not only simulate the game to get to our solution.&lt;/p&gt;
&lt;p&gt;Here is the mathematical formula for n players:&lt;/p&gt;
&lt;p&gt;&lt;span class="math display"&gt;\[
\sum_{i = 0}^{n-1} \binom{18}{i} * 0.5^i * 0.5^{18-i} * (n-i)
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;We can convert it to R Code and calculate the result.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;n &amp;lt;- 16

expected_fun &amp;lt;- function(i) choose(18, i) * 0.5^i * 0.5^(18-i) * (n - i)

map_dbl(0:(n-1), expected_fun) |&amp;gt; sum()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[1] 7&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Et voilà! The result from the Monte Carlo simulation was confirmed.&lt;/p&gt;
&lt;pre class="r distill-force-highlighting-css"&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;</description>
      <distill:md5>931ec4f7a283d4e0ee2c0ee0ed9c00ab</distill:md5>
      <category>R</category>
      <category>simulation</category>
      <guid>https://lukas-r.blog/posts/2021-12-05-looping-over-the-bridge</guid>
      <pubDate>Sun, 05 Dec 2021 00:00:00 +0000</pubDate>
      <media:content url="https://lukas-r.blog/posts/2021-12-05-looping-over-the-bridge/img/squid_game_bridge.jpg" medium="image" type="image/jpeg"/>
    </item>
    <item>
      <title>I started a Blog</title>
      <dc:creator>Lukas Gröninger</dc:creator>
      <link>https://lukas-r.blog/posts/welcome</link>
      <description>Why did I start it and what are my plans?</description>
      <guid>https://lukas-r.blog/posts/welcome</guid>
      <pubDate>Fri, 03 Dec 2021 00:00:00 +0000</pubDate>
    </item>
  </channel>
</rss>
